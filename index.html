<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
        <title>Formulir Data Diri</title>
        <script src="assets/js/tailwind.js"></script>
    </head>
    <body class="bg-gradient-to-b from-sky-800 to-cyan-700">
        <div
            class="flex flex-col items-center justify-center min-h-screen p-4 ">
            <div
                class="w-full max-w-md bg-white p-6 md:p-8 rounded-lg shadow-md">
                <img src="assets/logo.png" alt="Logo"
                    class="block mx-auto mb-4 w-40 h-auto">
                <h2 class="text-2xl font-bold text-center mb-2">Form Data
                    Diri</h2>
                <h3
                    class="text-lg text-gray-900 text-center mb-6 font-bold">Nama
                    Program</h3>
                <form id="data-form">
                    <div class="mb-4">
                        <label for="nama"
                            class="block text-gray-700 text-sm font-bold mb-2">Nama
                            Lengkap:</label>
                        <input type="text" id="nama" name="nama_lengkap"
                            placeholder="Masukkan nama Anda" required
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="mb-6" id="date-group">
                        <label for="tanggal_lahir"
                            class="block text-gray-700 text-sm font-bold mb-2">Tanggal
                            Lahir:</label>
                        <input type="date" id="tanggal_lahir"
                            name="tanggal_lahir" required
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline cursor-pointer">
                    </div>
                    <button type="submit" id="submit-button"
                        class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:bg-blue-300 disabled:cursor-not-allowed cursor-pointer">
                        Kirim
                    </button>
                </form>
                <div id="loading"
                    class="fixed inset-0 bg-black/50 flex items-center justify-center flex-col hidden">
                    <!-- <div class="bg-white p-4 rounded-lg shadow-md"> -->
                        <img src="assets/loading.gif" alt="Loading..."
                            class="mx-auto -mb-2 w-28 h-auto">
                        <p class="text-white text-lg font-bold">Mengirim data...</p>
                    <!-- </div> -->
                </div>
                <p id="status-message" class="text-center mt-4 font-bold"></p>
            </div>
        </div>

        <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyvfDOwFna8g2Q5EtwKBsNdkfTxZ0svjGGqm8qWhI2cUUxyS3tEWjV53Uu-tzgTgWwgzw/exec'; 
        
        const form = document.getElementById('data-form');
        const submitButton = document.getElementById('submit-button');
        const statusMessage = document.getElementById('status-message');

        const dateGroup = document.getElementById('date-group');
        const namaLengkap = document.getElementById('nama');
        const tanggalLahirInput = document.getElementById('tanggal_lahir');

        dateGroup.addEventListener('click', () => {
            if (typeof tanggalLahirInput.showPicker === 'function') {
                tanggalLahirInput.showPicker();
            } else {
                tanggalLahirInput.focus();
            }
        });

        form.addEventListener('submit', e => {
            e.preventDefault(); 

            const birthDateString = tanggalLahirInput.value;
            const birthDate = new Date(birthDateString);
            const today = new Date();

            today.setHours(0, 0, 0, 0);

            if (isNaN(birthDate.getTime()) || birthDate > today) {
                statusMessage.textContent = 'Tanggal lahir tidak valid atau berada di masa depan.';
                statusMessage.style.color = 'red';
                return;
            }

            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDifference = today.getMonth() - birthDate.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            submitButton.disabled = true;
            submitButton.textContent = 'Mengirim...';
            statusMessage.textContent = '';
            
            document.getElementById("loading").classList.remove("hidden");
            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
                .then(response => response.json())
                .then(data => {
                    const params = new URLSearchParams({
                        nama: namaLengkap.value
                    });               
                    window.location.href = `video.html?${params.toString()}`;
                })
                .catch(error => {
                    console.error('Error submitting form:', error);
                    const loadingDiv = document.getElementById("loading");
                    loadingDiv.innerHTML = `
                        <div class="bg-white p-8 rounded-lg shadow-md text-center max-w-sm mx-4">
                            <h2 class="text-2xl font-bold text-red-600 mb-4">Terjadi kesalahan!</h2>
                            <p class="text-gray-700 mb-6">Periksa koneksi Anda atau coba lagi.</p>
                            <button onclick="location.reload()" class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                                Coba Lagi
                            </button>
                        </div>
                    `;
                });
        });
    </script>
    </body>
</html>